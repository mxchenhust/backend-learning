

-------------------------
# TCP协议

TCP协议是面向连接的、可靠的、基于字节流的的传输层通信协议。

## 面对的问题
1. 由于TCP是面对互联网任意两个计算机上的进程的逻辑连接，所以需要有明确的连接建立阶段和连接结束阶段。
2. 任意两台计算机的链路连接可能存在往返时延的差异，所以触发重传的超时机制要有适用性。
3. 分组在通过因特网时可能需要重新排序，分组不能保证按时顺序到达目的主机。
4. 发送方需要了解接收方的缓冲区空间。（流量控制问题）
5. 网络链路可能存在一些问题，发生链路拥塞。（拥塞控制问题）

## 报文段格式
16位的源端口号和16位的目的端口号，32位的序号（Seq）和32位的确认序号（Ack），4位首部长度（代表报头拥有的4字节数），6位保留，6位标志位，16位的接收窗口大小，16位校验和（检验整个TCP报文），16位紧急指针，选项段和数据段

## 连接建立
因为TCP连接是全双工的，在连接建立阶段需要三次“握手”。
第一次握手  C->S      SYN  Seq=x
第二次握手  S->C      SYN+ACK  Seq=y，Ack=x+1
第三次握手  C->S      ACK  Ack=y+1
初始的Seq序号是随机的。

## 断开连接
断开连接需要四次“挥手”。
第一次挥手  C->S    FIN   Seq=u
第二次挥手  S->C    ACK   Seq=v，Ack=u+1  服务器进入关闭等待状态
第三次挥手  S->C    FIN   Seq=w，Ack=v+1
第四次挥手  C->S    ACK   Ack=w+1

## TIME_WAIT状态
TCP协议规定,主动关闭连接的一方要处于TIME_ WAIT状态,等待2*MSL(maximum segment lifetime)的时间后才能回到CLOSED状态。

## 解决面对问题的方法
1. 确认应答机制（ACK机制），可以在一定程度上解决乱序和分组丢失的问题
2. 超时重传机制，可以解决分组丢失和往返时间过大超时的问题。快速重传，在TCP等待看到三个重复确认，会重传分组。
3. 滑动窗口。发送方和接收方都维护各自的缓冲区大小，叫做窗口。滑动窗口可以一次性发送多个数据段，提高了传输的效率。
4. 流量控制。接收方会向发送方发送一个接收窗口大小，提示发送方的发送速度，可以防止接收方处理能力不足而导致的丢包重传问题。
5. 拥塞控制。TCP为每个连接维护一个拥塞窗口，用以反应链路状态。拥塞窗口加性增，乘性减。慢启动（指数增长，在达到阈值后线性增长）。

----------------
# UDP协议
UDP协议是面向事务的简单不可靠信息传送服务。资源消耗小，速度处理快。

## 报文段格式
16位源端口号，16位目的端口号，16位数据报长度，16位校验和，数据段。

## UDP特性
1. 在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制;在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。
2. 由于传输数据不建立连接，因此也就不需要维护连接状态，包括收发状态等，因此一台服务机可同时向多个客户机传输相同的消息。
3. UDP使用尽最大努力交付，即不保证可靠交付。
4. UDP不会对数据报重组，因此也不会将数据恢复到传输时的顺序。如果数据的顺序对应用程序很重要，那么应用程序只能自己标志数据的正确顺序，并决定如何处理这些数据。
5. UDP客户端进程是从动态可用端口中随机挑选一个端口号，用来作为会话的源端口，而目的端口通常都是分配到服务器进程的公认端口或已注册的端口。

--------------------------------
# HTTP协议
HTTP，是一种建立在TCP上的无状态连接。

## HTTP请求
HTTP请求由状态行、请求头、请求正文三部分组成。状态行：包括请求方式Method、资源路径URL、协议版本Version。请求头：包括一些访问的域名、用户代理、Cookie等信息。请求正文：就是HTTP请求的数据。

## HTTP响应
HTTP响应由三部分组成：状态行、响应头、响应正文。状态行：包括协议版本Version、状态码Status Code、回应短语。响应头：包括搭建服务器的软件，发送响应的时间，回应数据的格式等信息。响应正文：就是响应的具体数据。

状态码：1xx	表示HTTP请求已经接受，继续处理请求
        2xx	表示HTTP请求已经处理完成
        3xx	表示把请求访问的URL重定向到其他目录 
        4xx	表示客户端出现错误
        5xx	表示服务端出现错误
